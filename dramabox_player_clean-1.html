<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Dramabox Player – Auto</title>
  <style>
    body{margin:0;background:#0b0f17;color:#fff;font-family:system-ui}
    header{padding:14px;font-weight:900}
    .card{margin:12px;border-radius:14px;background:#121a29;padding:12px}
    video{width:100%;border-radius:14px;background:#000}
    button{width:100%;padding:14px;border-radius:14px;border:none;
      background:#2563eb;color:#fff;font-weight:900;font-size:16px}
    .status{margin-top:10px;font-size:12px;opacity:.85;white-space:pre-wrap}
  </style>
</head>
<body>
<header>Dramabox Player (Auto)</header>

<div class="card">
  <video id="video" controls playsinline></video>
  <button id="btn">▶️ PLAY EPISODE 1</button>
  <div class="status" id="status">Siap.</div>
</div>

<script>
const BASE = "https://dramabox.bagahproject.dev";
const BOOK_ID = "42000004347"; // FIXED
const QUALITY = 720; // default aman

const video = document.getElementById("video");
const statusEl = document.getElementById("status");
const btn = document.getElementById("btn");

function status(t){ statusEl.textContent = t; }

async function loadAndPlay(){
  try{
    status("Mengambil chapter...");
    const res = await fetch(`${BASE}/api/chapters?bookId=${BOOK_ID}`);
    const json = await res.json();
    const chapters = json.data || [];
    if(!chapters.length){ status("Chapter kosong."); return; }

    const ch = chapters[0]; // EP 1
    let url = null;

    for(const cdn of ch.cdnList || []){
      for(const v of cdn.videoPathList || []){
        if(v.quality === QUALITY){ url = v.videoPath; break; }
      }
      if(url) break;
    }

    if(!url){
      url = ch.cdnList?.[0]?.videoPathList?.[0]?.videoPath;
    }

    if(!url){ status("Video tidak ditemukan."); return; }

    video.src = url;
    await video.play();
    status("Playing EP 1 ✅");
  }catch(e){
    status("Error: " + e.message);
  }
}

btn.onclick = loadAndPlay;
loadAndPlay(); // auto play on open
</script>
</body>
</html>
